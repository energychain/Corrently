/*!
 * Corrently - Grayscale v5.0.1 (https://startbootstrap.com/template-overviews/grayscale)
 * Copyright 2018-2018 Start Bootstrap
 * Licensed under MIT
 */
function shortName(t,e){return void 0===t[e]?e==$.qparam("a")?"<span class='second'>this account</span>":e.substr(0,10)+"...":e==$.qparam("a")?"<span class='second'>"+t[e].short_name+"</span>":t[e].short_name}function app(b){document.app={},document.app.provider=ethers.providers.getDefaultProvider("homestead");var t,e=ethers.providers.getDefaultProvider();$("#account").html(shortName(b,$.qparam("a"))),void 0!==b[$.qparam("a")]&&void 0!==b[$.qparam("a")].description&&$("#description").html(b[$.qparam("a")].description),e.getBalance($.qparam("a")).then(function(t){$("#balance").html((1*ethers.utils.formatEther(t).toString()).toFixed(4))}),t=6e6,null!=window.localStorage.getItem("txcache_"+$.qparam("a"))?(txcache=JSON.parse(window.localStorage.getItem("txcache_"+$.qparam("a"))),t=txcache[txcache.length-1].blockNumber):txcache=[],$.getJSON("https://api.etherscan.io/api?module=account&action=txlist&address="+$.qparam("a")+"&startblock="+t+"&endblock=99999999&sort=asc&apikey=YourApiKeyToken",function(a){$.getJSON("https://api.etherscan.io/api?module=account&action=txlistinternal&address="+$.qparam("a")+"&startblock="+t+"&endblock=99999999&sort=asc&apikey=YourApiKeyToken",function(t){results=[];for(var e=0;e<txcache.length;e++)results.push(txcache[e]);for(e=0;e<a.result.length;e++)results.push(a.result[e]);for(e=0;e<t.result.length;e++)results.push(t.result[e]);var m=[],p=[];!function e(){if(0<results.length)x=results.pop(),x.eth=ethers.utils.formatEther(x.value),x.timestamp=x.timeStamp,x.to_friendly=shortName(b,x.to),x.from_friendly=shortName(b,x.from),void 0===p["b_"+x.blockNumber]?(p["b_"+x.blockNumber]=x.blockNumber,null==window.localStorage.getItem("b_"+x.blockNumber)?$.getJSON("https://min-api.cryptocompare.com/data/pricehistorical?fsym=ETH&tsyms=EUR&ts="+x.timestamp+"&extraParams=corrently",function(t){console.log("Missing Time",t,x.blockNumber),window.localStorage.setItem("b_"+x.blockNumber,t.ETH.EUR),x.eur=x.eth*t.ETH.EUR,m.push(x),e()}):(x.eur=x.eth*window.localStorage.getItem("b_"+x.blockNumber),x.rate=window.localStorage.getItem("b_"+x.blockNumber),m.push(x),e())):e();else{balance_assets=[],balance_liabilities=[];for(var t=0;t<m.length;t++)if(1e-4<m[t].eur){$("#ledgerIt").append("<tr><td title='Block:"+m[t].blockNumber+"'>"+new Date(1e3*m[t].timestamp).toLocaleString()+"</td><td title='"+m[t].from+"'><a href='./ledger_otc.html?a="+m[t].from+"'>"+m[t].from_friendly+"</a></td><td title='"+m[t].to+"'><a href='./ledger_otc.html?a="+m[t].to+"'>"+m[t].to_friendly+"</a></td><td align='right'>"+(1*m[t].eth).toFixed(4)+"</td><td align='right'>"+m[t].eur.toFixed(2)+"</td></tr>");var a={};a.eur=m[t].eur,a.eth=m[t].eth,m[t].to==$.qparam("a")&&(a.peer=m[t].from,a.peer_friendly=m[t].from_friendly,a.eth=1*a.eth,a.eur=1*a.eur,void 0===balance_liabilities[m[t].from]?balance_liabilities[m[t].from]=a:(balance_liabilities[m[t].from].eth+=1*a.eth,balance_liabilities[m[t].from].eur+=1*a.eur)),m[t].from==$.qparam("a")&&(a.peer=m[t].to,a.peer_friendly=m[t].to_friendly,a.eth=1*a.eth,a.eur=1*a.eur,void 0===balance_assets[m[t].to]?balance_assets[m[t].to]=a:(balance_assets[m[t].to].eth+=1*a.eth,balance_assets[m[t].to].eur+=1*a.eur))}var r=[],i=0,l=0;for(var o in balance_assets){var s="<td><a href='?a="+o+"'>"+balance_assets[o].peer_friendly+"</a></td><td align='right'>"+balance_assets[o].eur.toFixed(2)+"</td><td align='right'>"+balance_assets[o].eth.toFixed(4)+"</td>";i+=balance_assets[o].eth,l+=balance_assets[o].eur,r.push(s)}var n=[],c=0,h=0;for(var o in balance_liabilities)s="<td><a href='?a="+o+"'>"+balance_liabilities[o].peer_friendly+"</a></td><td align='right'>"+balance_liabilities[o].eur.toFixed(2)+"</td><td align='right'>"+balance_liabilities[o].eth.toFixed(4)+"</td>",c+=balance_liabilities[o].eth,h+=balance_liabilities[o].eur,n.push(s);n.push("<th class='second'>Equity</th><th style='text-align:right' class='second'>"+(h-l).toFixed(2)+"</th><th style='text-align:right' class='second'>"+(c-i).toFixed(4)+"</th>");var d="",u=r.length;for(n.length>r.length&&(u=n.length),t=0;t<u;t++)d+="<tr>",t<r.length?d+=r[t]:d+="<td colspan=3>&nbsp;</td>",t<n.length?d+=n[t]:d+="<td colspan=3>&nbsp;</td>",d+="</tr>";d+="<tr><th>&nbsp;</th><th style='text-align:right'>"+h.toFixed(2)+"</th><th style='text-align:right'>"+c.toFixed(4)+"</th>Balance<th></th><th style='text-align:right'>"+h.toFixed(2)+"</th><th style='text-align:right'>"+c.toFixed(4)+"</th></tr>",$("#balanceSheet").append(d),window.localStorage.setItem("txcache_"+$.qparam("a"),JSON.stringify(m))}}()})})}$.qparam=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.search);return null!==e&&(e[1]||0)},$(document).ready(function(){$.getJSON("./data/kyc.json",function(e){$.getJSON("/data/xchangerate.json",function(t){$.each(t,function(t,e){window.localStorage.setItem(t,e)}),app(e)})})});