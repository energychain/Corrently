/*!
 * Corrently - Grayscale v5.0.1 (https://startbootstrap.com/template-overviews/grayscale)
 * Copyright 2018-2018 Start Bootstrap
 * Licensed under MIT
 */
function shortName(t,e){return void 0===t[e]?e==$.qparam("a")?"<span class='second'>this account</span>":0==e.length?"/smart contract deployment/":e.substr(0,10)+"...":e==$.qparam("a")?"<span class='second'>"+t[e].short_name+"</span>":t[e].short_name}function app(_){document.app={},document.app.provider=ethers.providers.getDefaultProvider("homestead");var t,e=ethers.providers.getDefaultProvider();$("#account").html(shortName(_,$.qparam("a"))),void 0!==_[$.qparam("a")]&&void 0!==_[$.qparam("a")].description&&$("#description").html(_[$.qparam("a")].description),e.getBalance($.qparam("a")).then(function(t){$("#balance").html((1*ethers.utils.formatEther(t).toString()).toFixed(4)),$("#balance").attr("data",1*ethers.utils.formatEther(t).toString())}),t=6e6,null!=window.localStorage.getItem("txcache_"+$.qparam("a"))?(txcache=JSON.parse(window.localStorage.getItem("txcache_"+$.qparam("a"))),t=txcache[txcache.length-1].blockNumber):txcache=[],$.getJSON("https://api.etherscan.io/api?module=account&action=txlist&address="+$.qparam("a")+"&startblock="+t+"&endblock=99999999&sort=asc&apikey=YourApiKeyToken",function(r){$.getJSON("https://api.etherscan.io/api?module=account&action=txlistinternal&address="+$.qparam("a")+"&startblock="+t+"&endblock=99999999&sort=asc&apikey=YourApiKeyToken",function(t){results=[];for(var e=0;e<txcache.length;e++)results.push(txcache[e]);var a={};for(e=0;e<r.result.length;e++)a[r.result[e].blockNumber]=1,results.push(r.result[e]);for(e=0;e<t.result.length;e++)void 0===a[t.result[e].blockNumber]||(t.result[e].blockNumber=t.result[e]+"_internal"),results.push(t.result[e]);var b=[],f=[];!function e(){if(0<results.length)x=results.pop(),x.eth=ethers.utils.formatEther(x.value),x.timestamp=x.timeStamp,x.to_friendly=shortName(_,x.to),x.from_friendly=shortName(_,x.from),void 0===f["b_"+x.blockNumber]?(f["b_"+x.blockNumber]=x.blockNumber,null==window.localStorage.getItem("b_"+x.blockNumber)?$.getJSON("https://min-api.cryptocompare.com/data/pricehistorical?fsym=ETH&tsyms=EUR&ts="+x.timestamp+"&extraParams=corrently",function(t){console.log("Missing Time",t,x.blockNumber),window.localStorage.setItem("b_"+x.blockNumber,t.ETH.EUR),x.eur=x.eth*t.ETH.EUR,b.push(x),e()}):(x.eur=x.eth*window.localStorage.getItem("b_"+x.blockNumber),x.rate=window.localStorage.getItem("b_"+x.blockNumber),b.push(x),e())):e();else{balance_assets=[],balance_liabilities=[];for(var t=0,a=0;a<b.length;a++)if(-1e-4<b[a].eur){$("#ledgerIt").append("<tr><td title='Block:"+b[a].blockNumber+"'>"+new Date(1e3*b[a].timestamp).toLocaleString()+"</td><td title='"+b[a].from+"'><a href='./ledger_otc.html?a="+b[a].from+"'>"+b[a].from_friendly+"</a></td><td title='"+b[a].to+"'><a href='./ledger_otc.html?a="+b[a].to+"'>"+b[a].to_friendly+"</a></td><td align='right'>"+b[a].eur.toFixed(2)+"</td><td align='right'>"+(1*b[a].eth).toFixed(4)+"</td></tr>");var r={};r.eur=b[a].eur,r.eth=b[a].eth,b[a].to==$.qparam("a")&&(r.peer=b[a].from,r.peer_friendly=b[a].from_friendly,r.eth=1*r.eth,r.eur=1*r.eur,void 0===balance_liabilities[b[a].from]?balance_liabilities[b[a].from]=r:(balance_liabilities[b[a].from].eth+=1*r.eth,balance_liabilities[b[a].from].eur+=1*r.eur)),b[a].from==$.qparam("a")&&(r.peer=b[a].to,console.log(b[a],1*b[a].gasUsed*b[a].gasPrice),"call"!=b[a].type&&(t+=ethers.utils.formatEther(b[a].gasUsed)*ethers.utils.formatEther(1*b[a].gasPrice)),r.peer_friendly=b[a].to_friendly,r.eth=1*r.eth,r.eur=1*r.eur,void 0===balance_assets[b[a].to]?balance_assets[b[a].to]=r:(balance_assets[b[a].to].eth+=1*r.eth,balance_assets[b[a].to].eur+=1*r.eur))}console.log(t),gasUsed=t;var l=[],s=1*gasUsed,i=0;for(var o in balance_assets){var n="<td><a href='?a="+o+"'>"+balance_assets[o].peer_friendly+"</a></td><td align='right'>"+balance_assets[o].eur.toFixed(2)+"</td><td align='right'>"+balance_assets[o].eth.toFixed(4)+"</td>";s+=balance_assets[o].eth,i+=balance_assets[o].eur,l.push(n)}var c=[],d=0,h=0;for(var o in balance_liabilities)n="<td><a href='?a="+o+"'>"+balance_liabilities[o].peer_friendly+"</a></td><td align='right'>"+balance_liabilities[o].eur.toFixed(2)+"</td><td align='right'>"+balance_liabilities[o].eth.toFixed(4)+"</td>",d+=balance_liabilities[o].eth,h+=balance_liabilities[o].eur,c.push(n);var g=i/s;if(i+=gasUsed*g,l.push("<td>Transaction Costs</td><td style='text-align:right'>"+(gasUsed*g).toFixed(2)+"</td><td style='text-align:right'>"+(1*gasUsed).toFixed(4)+"</td>"),null!=$("#balance").attr("data")){var u=d-s;console.log(s),s+=u,i+=u*g,l.push("<td>Accurals and Deferrals (SC)</td><td style='text-align:right'>"+(u*g).toFixed(2)+"</td><td style='text-align:right' >"+u.toFixed(4)+"</td>"),c.push("<th class='second'>Equity</th><th style='text-align:right' class='second'>"+($("#balance").attr("data")*g).toFixed(2)+"</th><th style='text-align:right' class='second'>"+(1*$("#balance").attr("data")).toFixed(4)+"</th>")}h<i?(c.push("<td>Exchange Profit (EUR/ETH)</td><td style='text-align:right'>"+(i-h).toFixed(2)+"</td><td style='text-align:right' >0</td>"),h+=i-h):(l.push("<td>Exchange Loss (EUR/ETH)</td><td style='text-align:right'>"+(h-i).toFixed(2)+"</td><td style='text-align:right' >0</td>"),i+=h-i);var m="",p=l.length;for(c.length>l.length&&(p=c.length),a=0;a<p;a++)m+="<tr>",a<l.length?m+=l[a]:m+="<td colspan=3>&nbsp;</td>",a<c.length?m+=c[a]:m+="<td colspan=3>&nbsp;</td>",m+="</tr>";m+="<tr><th>&nbsp;</th><th style='text-align:right'>"+i.toFixed(2)+"</th><th style='text-align:right'>"+s.toFixed(4)+"</th>Balance<th></th><th style='text-align:right'>"+h.toFixed(2)+"</th><th style='text-align:right'>"+d.toFixed(4)+"</th></tr>",$("#balanceSheet").append(m),window.localStorage.setItem("txcache_"+$.qparam("a"),JSON.stringify(b))}}()})})}$.qparam=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.search);return null!==e&&(e[1]||0)},$(document).ready(function(){$.getJSON("./data/kyc.json",function(e){$.getJSON("/data/xchangerate.json",function(t){$.each(t,function(t,e){window.localStorage.setItem(t,e)}),app(e)})})});